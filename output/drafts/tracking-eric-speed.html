<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>What is the average speed of seagull Eric? - LifeWatch INBO</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <meta name="google-site-verification" content="bHOQjaP_2zAxd-nxU1TDYpBAasDIAgtgbSKcckig3iQ" />

        <link rel="shortcut icon" href="http://lifewatch.inbo.be/blog/theme/img/favicon.ico">
        <link rel="stylesheet" href="http://lifewatch.inbo.be/blog/theme/css/normalize.css">
        <link rel="stylesheet" href="http://lifewatch.inbo.be/blog/theme/css/main.css">
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400">
        <link rel="stylesheet" href="http://lifewatch.inbo.be/blog/theme/css/font-awesome.min.css">
        <!--[if IE 7]>
        <link rel="stylesheet" href="http://lifewatch.inbo.be/blog/theme/css/font-awesome-ie7.min.css">
        <![endif]-->
        <script src="http://lifewatch.inbo.be/blog/theme/js/vendor/modernizr-2.6.2.min.js"></script>

        <link href="http://lifewatch.inbo.be/blog/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="LifeWatch INBO Full RSS feed" />
    </head>
    <body>
    <div class="container">
        <!-- Content -->
        <div class="header">
            <header class="clearfix">
                <h2><a href="http://lifewatch.inbo.be/blog">LifeWatch INBO</a></h2>
                <nav>
                    <ul>
                        <li><a href="http://lifewatch.inbo.be/blog/pages/about.html">About</a></li>
                    </ul>
                </nav>
            </header>
            <div>
                <img src="http://lifewatch.inbo.be/blog/theme/img/inbo-logo.png" alt="inbo-logo"/>
            </div>
        </div>
        <div class="content">
<article>
	<section class="single">
        <header>
            <h1>What is the average speed of seagull Eric?</h1>
        </header>
        <footer>
            <time datetime="2013-12-01T11:00:00" pubdate>December 01, 2013</time>
            <address class="vcard">
                By <a class="url fn" href="http://lifewatch.inbo.be/blog/author/peter-desmet.html">Peter Desmet</a>
            </address>
            <ul class="tags">Tagged: 
                <li><a href="http://lifewatch.inbo.be/blog/tag/bird-tracking.html">bird tracking</a></li>
                <li><a href="http://lifewatch.inbo.be/blog/tag/visualization.html">visualization</a></li>
                <li><a href="http://lifewatch.inbo.be/blog/tag/cartodb.html">CartoDB</a></li>
                <li><a href="http://lifewatch.inbo.be/blog/tag/tutorial.html">tutorial</a></li>
            </ul>
        </footer>
        <div>
            <p>In our <a href="http://lifewatch.inbo.be/blog/posts/tracking-eric.html">previous post</a> we explored how we can visualize two months of tracking data with <a href="http://cartodb.com/">CartoDB</a>. This time, we have another look at the data to discover what distance and speed lesser black-backed gull Eric covered.</p>
<h2>Calculating the distance</h2>
<p>Similar to how we calculated <code>duration_in_seconds</code><sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>, we will associate a <code>distance_in_meters</code> to each occurrence point<sup id="fnref:2"><a class="footnote-ref" href="#fn:2" rel="footnote">2</a></sup>. We do this by calculating the distance between <code>the_geom</code> of the current point and <code>the_geom</code> of the previous point, using the <a href="http://www.postgresql.org/docs/9.3/static/functions-window.html">lag()</a> and <a href="http://postgis.net/docs/ST_Distance_Sphere.html">st_distance_sphere()</a> functions.  Although we can do this in a view, we'll add <code>duration_in_meters</code> as a field in the table for further use:</p>
<div class="highlight"><pre><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tracking_eric</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">distance_in_meters</span> <span class="n">double</span> <span class="k">precision</span>
</pre></div>


<p>Then:</p>
<div class="highlight"><pre><span class="k">WITH</span> <span class="n">calc_distance</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="n">cartodb_id</span><span class="p">,</span>
        <span class="n">ST_Distance_Sphere</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span><span class="n">lag</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">date_time</span><span class="p">))</span> <span class="k">AS</span> <span class="n">distance_in_meters</span>
    <span class="k">FROM</span> <span class="n">tracking_eric</span>
    <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">date_time</span>
<span class="p">)</span>
<span class="k">UPDATE</span> <span class="n">tracking_eric</span>
<span class="k">SET</span> <span class="n">distance_in_meters</span> <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">distance_in_meters</span>
<span class="k">FROM</span> <span class="n">calc_distance</span> <span class="k">c</span>
<span class="k">WHERE</span> <span class="k">c</span><span class="p">.</span><span class="n">cartodb_id</span> <span class="o">=</span> <span class="n">tracking_eric</span><span class="p">.</span><span class="n">cartodb_id</span>
</pre></div>


<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>See "Analyzing time spent per UTM 1km square" in the <a href="http://lifewatch.inbo.be/blog/posts/tracking-eric.html">previous post</a>.&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>You can visualize both parameters as the time and distance it took to <strong>arrive</strong> at that point, which is why the first record has <code>null</code> for these parameters.&#160;<a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>
        </div>
    </section>
    <section class="comments">
        <header class="clearfix">
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="LifeWatchINBO" data-size="large" data-related="LifeWatchINBO">Tweet</a>
            <h2>Comments</h2>
        </header>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
        </script>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'lifewatchinbo'; 

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </section>
</article>
        </div>
        <div class="footer">
            <footer class="clearfix">
                <div>
                    <img src="http://lifewatch.inbo.be/blog/theme/img/lifewatch-inbo-logo.png" alt="lifewatch-inbo-logo"/>
                </div>
                <div>
                    <ul>
                        <h2>Keep in touch</h2>
                        <li><a href="https://twitter.com/LifeWatchINBO">Follow us on Twitter</a></li>
                        <li><a href="https://github.com/LifeWatchINBO">Our GitHub repositories</a></li>
                        <li><a href="http://lifewatch.inbo.be/blog/feeds/rss.xml">Subscribe to updates</a></li>
                    </ul>
                </div>
                <div>
                    <ul>
                        <h2>Related websites</h2>
                        <li><a href="http://www.inbo.be">Research Institute for Nature and Forest (INBO)</a></li>
                        <li><a href="http://www.lifewatch.be">Belgian LifeWatch portal</a></li>
                        <li><a href="http://www.lifewatch.eu">European LifeWatch portal</a></li>
                    </ul>
                </div>
                <p class="disclaimer">The views expressed on this blog represent the ideas of the author(s) and are not to be considered an INBO or institutional policy. Unless stated otherwise, all content on this <a xmlns:cc="http://creativecommons.org/ns#" href="http://lifewatch.inbo.be/blog" property="cc:attributionName" rel="cc:attributionURL">LifeWatch INBO blog</a> is licensed under a <a rel ="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.</p>
            </footer>
        </div>
    </div>

        <!-- Scripts -->
        <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
        <!--<script>window.jQuery || document.write('<script src="http://lifewatch.inbo.be/blog/theme/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>-->
        <!--<script src="http://lifewatch.inbo.be/blog/theme/js/plugins.js"></script>-->
        <!--<script src="http://lifewatch.inbo.be/blog/theme/js/main.js"></script>-->
        <script>
            var _gaq=[['_setAccount','UA-42312007-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>